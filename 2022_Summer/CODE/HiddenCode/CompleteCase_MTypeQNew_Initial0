{"cells":[{"cell_type":"code","execution_count":1,"metadata":{"id":"2q4HuBPEslX4","executionInfo":{"status":"ok","timestamp":1652880534119,"user_tz":300,"elapsed":7,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"}}},"outputs":[],"source":["import numpy as np\n","\n","dim_ostate = 4*4*4 # ni * nj * population\n","dim_action = 3\n","dim_observe = 4 # income\n","\n","theta1 =0*np.array( [4.272-3.801, -0.356, -0.237,0.004, -0.03, 33.976,#0.005,  0.01,\n","          3.109-1.377,  -2, -0.241,-0.088, -0.171, 13.114])#,0    ,0.01]\n","#theta21 = 0.95\n","#theta23 = [0.95,0.01] + [0.42,0.01] + [0.02,0.45]\n","\n","a_old = np.arange(dim_action,dtype = int)\n","z_old = np.arange(dim_observe,dtype = int)\n","os_old = np.arange(dim_ostate,dtype = int)\n","\n","ni_old = os_old//16\n","nj_old = os_old//4%4\n","pop_old = os_old%4%4 #pop_old+n2_old*4+n1_old*16"]},{"cell_type":"markdown","metadata":{"id":"F8ljIXuXK5g9"},"source":["# 0.1Upload and Handle Data"]},{"cell_type":"code","execution_count":2,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":28289,"status":"ok","timestamp":1652880562403,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"pTvmOgtuOaEa","outputId":"177d2cc0-e0a0-4501-f7cd-2095a4d3d21c"},"outputs":[{"output_type":"stream","name":"stdout","text":["Mounted at /content/drive\n"]}],"source":["from google.colab import drive\n","drive.mount('/content/drive')"]},{"cell_type":"code","execution_count":3,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":2261,"status":"ok","timestamp":1652880564658,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"mhgsK_1RtbAC","outputId":"79f57a01-8bd5-44b8-8b13-cde60c40a55f"},"outputs":[{"output_type":"stream","name":"stdout","text":["15 341 1 43\n"]}],"source":["import pickle\n","file_name = '/content/drive/MyDrive/2022_SUMMER/Research_Burger/CODE/TranslatePythonCode/'\n","with open(file_name + 'Q_new.txt','rb') as fp:\n","  mtype_prob = pickle.load(fp)\n","\n","mtype_int = -1*np.ones(400,dtype = int)\n","for i in range(400):\n","  mtype_max = max(mtype_prob[i])\n","  if mtype_max >1/3:\n","    mtype_int[i] = np.where(mtype_prob[i] == mtype_max)[0][0] +1\n","print(np.sum(mtype_int==-1),np.sum(mtype_int==1),np.sum(mtype_int==2),np.sum(mtype_int==3))"]},{"cell_type":"code","execution_count":4,"metadata":{"id":"R6n3XxjnuLG-","executionInfo":{"status":"ok","timestamp":1652880565331,"user_tz":300,"elapsed":503,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"}}},"outputs":[],"source":["def quantile(x,p,method=1):\n","\n","  x = np.sort(x)\n","  n = len(x)\n","  if method == 3:\n","    qq = x[int(np.ceil(np.min(np.max(1,p*n),n)))-1]\n","  else:                         \n","    x = np.hstack([x[0], x,x[-1]])\n","    if method == 2:\n","        i = p*(n+1)+1\n","    else:\n","        i = p*n+1.5\n","    iu = int(np.ceil(i))\n","    il = int(np.floor(i))\n","    d = i-il\n","    qq = x[il-1]*(1-d)+x[iu-1]*d\n","  q = qq\n","  return q\n","\n","import scipy.io\n","mat = scipy.io.loadmat(file_name + 'canadafastfood_resorted.mat')\n","data = mat['data']\n","\n","#% Labeling\n","MT = len(data)          #% Size of the dataset (M x T = 400 x 35 = 14000).#clusterid = np.int_(data[:,0])      % Unique market ID.\n","market = np.int_(data[:,0])-1\n","year = np.int_(data[:,1])\n","N_aw  = np.int_(data[:,2])\n","N_bk  = np.int_(data[:,3])\n","N_hvy = np.int_(data[:,4])\n","N_mcd = np.int_(data[:,5])\n","N_wdy = np.int_(data[:,6])\n","#lagN_aw  = np.int_(data[:,7])lagN_bk  = np.int_(data[:,8])lagN_hvy = np.int_(data[:,9])lagN_mcd = np.int_(data[:,10])lagN_wdy = np.int_(data[:,11])\n","fwdN_aw  = np.int_(data[:,12])\n","fwdN_bk  = np.int_(data[:,13])\n","fwdN_hvy = np.int_(data[:,14])\n","fwdN_mcd = np.int_(data[:,15])\n","fwdN_wdy = np.int_(data[:,16])\n","a_aw  = np.int_(data[:,17])\n","a_bk  = np.int_(data[:,18])\n","a_hvy = np.int_(data[:,19])\n","a_mcd = np.int_(data[:,20])\n","a_wdy = np.int_(data[:,21])\n","pop = data[:,23]#val = data[:,24]\n","inc = data[:,25]\n","fpop = data[:,27]\n","finc = data[:,28]#fval = data[:,29]\n","#mktfe = data[:,30]         #% Market fixed effect estimates (from 130913_alaToivanenWaterson3_Fixedeffect3quantile.csv/dta)\n","#tertile = np.int_(data[:,31])       #% Market type initial guess (from 130913_alaToivanenWaterson3_Fixedeffect3quantile.csv/dta)\n","tertile = np.kron(np.ones(35),mtype_int)\n","\n","#% Number of own shops (in state space; capped at 3), from the perspective of each firm\n","Ni_aw = (N_aw <= 3)*N_aw + (N_aw > 3)*3\n","Ni_bk = (N_bk <= 3)*N_bk + (N_bk > 3)*3\n","Ni_hvy = (N_hvy <= 3)*N_hvy + (N_hvy > 3)*3\n","Ni_mcd = (N_mcd <= 3)*N_mcd + (N_mcd > 3)*3\n","Ni_wdy = (N_wdy <= 3)*N_wdy + (N_wdy > 3)*3\n","Ni_faw = (fwdN_aw <= 3)*fwdN_aw + (fwdN_aw > 3)*3\n","Ni_fbk = (fwdN_bk <= 3)*fwdN_bk + (fwdN_bk > 3)*3\n","Ni_fhvy = (fwdN_hvy <= 3)*fwdN_hvy + (fwdN_hvy > 3)*3\n","Ni_fmcd = (fwdN_mcd <= 3)*fwdN_mcd + (fwdN_mcd > 3)*3\n","Ni_fwdy = (fwdN_wdy <= 3)*fwdN_wdy + (fwdN_wdy > 3)*3\n","#% Number of rival shops (in state space; capped at 3), from the perspective of each firm\n","Nj_aw = N_bk + N_hvy + N_mcd + N_wdy\n","Nj_bk = N_aw + N_hvy + N_mcd + N_wdy\n","Nj_hvy = N_aw + N_bk + N_mcd + N_wdy\n","Nj_mcd = N_aw + N_bk + N_hvy + N_wdy\n","Nj_wdy = N_aw + N_bk + N_hvy + N_mcd\n","\n","Nj_aw = (Nj_aw <= 3)*Nj_aw + (Nj_aw > 3)*3     \n","Nj_bk = (Nj_bk <= 3)*Nj_bk + (Nj_bk > 3)*3\n","Nj_hvy = (Nj_hvy <= 3)*Nj_hvy + (Nj_hvy > 3)*3\n","Nj_mcd = (Nj_mcd <= 3)*Nj_mcd + (Nj_mcd > 3)*3\n","Nj_wdy = (Nj_wdy <= 3)*Nj_wdy + (Nj_wdy > 3)*3\n","\n","Nj_faw = fwdN_bk + fwdN_hvy + fwdN_mcd + fwdN_wdy\n","Nj_fbk = fwdN_aw + fwdN_hvy + fwdN_mcd + fwdN_wdy\n","Nj_fhvy = fwdN_aw + fwdN_bk + fwdN_mcd + fwdN_wdy\n","Nj_fmcd = fwdN_aw + fwdN_bk + fwdN_hvy + fwdN_wdy\n","Nj_fwdy = fwdN_aw + fwdN_bk + fwdN_hvy + fwdN_mcd\n","\n","Nj_faw = (Nj_faw <= 3)*Nj_faw + (Nj_faw > 3)*3     \n","Nj_fbk = (Nj_fbk <= 3)*Nj_fbk + (Nj_fbk > 3)*3\n","Nj_fhvy = (Nj_fhvy <= 3)*Nj_fhvy + (Nj_fhvy > 3)*3\n","Nj_fmcd = (Nj_fmcd <= 3)*Nj_fmcd + (Nj_fmcd > 3)*3\n","Nj_fwdy = (Nj_fwdy <= 3)*Nj_fwdy + (Nj_fwdy > 3)*3\n","#% Obtain 4 quantiles for main market characteristics.\n","pop25 = quantile(pop,0.25)   \n","inc25 = quantile(inc,0.25)  \n","pop50 = quantile(pop,0.5)  \n","inc50 = quantile(inc,0.5)  \n","pop75 = quantile(pop,0.75)   \n","inc75 = quantile(inc,0.75)   \n","\n","disc_pop = np.int_(pop > pop25) + np.int_(pop > pop50) + np.int_(pop > pop75)  \n","disc_inc = np.int_(inc > inc25) + np.int_( inc > inc50) + np.int_(inc > inc75)\n","disc_fpop = np.int_(fpop > pop25) + np.int_(fpop > pop50) +  np.int_(fpop > pop75) \n","disc_finc = np.int_(finc > inc25) + np.int_( finc > inc50) + np.int_(finc > inc75) \n","\n","# #% Define state variables for each firm\n","# RHS_aw = np.vstack([Ni_aw, Nj_aw, disc_pop, disc_inc]).T#;         % State for A & W.      \n","# RHS_bk = np.vstack([Ni_bk, Nj_bk, disc_pop, disc_inc]).T#;         % State for Burger King.      \n","# RHS_hvy = np.vstack([Ni_hvy, Nj_hvy, disc_pop, disc_inc]).T#;      % State for Harvey's.      \n","# RHS_mcd = np.vstack([Ni_mcd, Nj_mcd, disc_pop, disc_inc]).T#;      % State for McDonald's.      \n","# RHS_wdy =np.vstack( [Ni_wdy, Nj_wdy, disc_pop, disc_inc]).T#;      % State for Wendy's.      "]},{"cell_type":"code","execution_count":5,"metadata":{"id":"185nEl9uxA33","executionInfo":{"status":"ok","timestamp":1652880565332,"user_tz":300,"elapsed":6,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"}}},"outputs":[],"source":["# haha1 = fwdN_aw.reshape([35,400])\n","# haha2 = N_aw.reshape([35,400])\n","# np.sum(np.abs(haha2[1:,:] -haha1[0:-1,:]))"]},{"cell_type":"code","execution_count":6,"metadata":{"executionInfo":{"elapsed":6,"status":"ok","timestamp":1652880565333,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"J8OcqHzaKyAX"},"outputs":[],"source":["#market type\n","hidstate = np.int_(tertile==1) #-1\n","N_obser = np.sum(hidstate==1,dtype=int)"]},{"cell_type":"code","execution_count":7,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":223,"status":"ok","timestamp":1652880565551,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"KE3HJai9NGX-","outputId":"ebb12b3a-b5cd-46b2-ac2e-bf4afdac90ee"},"outputs":[{"output_type":"stream","name":"stdout","text":["################################population#######################################\n","2722&81&0&0\\\\\n","0&2926&137&0\\\\\n","0&1&2926&126\\\\\n","0&0&5&3011\\\\\n","Unstable term:350 (2.93%)\n","0.971 0.029 0.000 0.000\n","0.000 0.955 0.045 0.000\n","0.000 0.000 0.958 0.041\n","0.000 0.000 0.002 0.998\n","################################income#######################################\n","2782&285&0&0\\\\\n","39&2614&354&0\\\\\n","0&61&2657&245\\\\\n","0&0&46&2852\\\\\n","Unstable term:1030 (8.63%)\n","0.907 0.093 0.000 0.000\n","0.013 0.869 0.118 0.000\n","0.000 0.021 0.897 0.083\n","0.000 0.000 0.016 0.984\n"]}],"source":["def PrintLatex(matrixs):\n","  for i in range(len(matrixs)):\n","    print('{}&{}&{}&{}\\\\\\\\'.format(matrixs[i][0],matrixs[i][1],matrixs[i][2],matrixs[i][3]))\n","\n","dim_obser = 4\n","print('################################{}#######################################'.format('population'))\n","fs1, bs1 = (disc_fpop[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(disc_pop[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","tran1 = np.zeros([dim_obser,dim_obser],dtype=int)\n","for i in range(len(fs1)):\n","  tran1[bs1[i],fs1[i]] +=1\n","PrintLatex(tran1)\n","print('Unstable term:{} ({:.2f}%)'.format(N_obser-np.sum([tran1[i][i] for i in range(dim_obser)]),\n","                                    (N_obser-np.sum([tran1[i][i] for i in range(dim_obser)]))/N_obser*100) )\n","haha = tran1/np.sum(tran1,axis=1).reshape([dim_obser,1]).dot(np.ones([1,dim_obser]))\n","\n","for i in range(len(haha)):\n","  print('{:.3f} {:.3f} {:.3f} {:.3f}'.format(haha[i,0],haha[i,1],haha[i,2],haha[i,3]))\n","print('################################{}#######################################'.format('income'))\n","fs2, bs2 = (disc_finc[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(disc_inc[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","tran2 = np.zeros([dim_obser,dim_obser],dtype=int)\n","for i in range(len(fs2)):\n","  tran2[bs2[i],fs2[i]] +=1\n","PrintLatex(tran2)\n","print('Unstable term:{} ({:.2f}%)'.format(N_obser-np.sum([tran2[i][i] for i in range(dim_obser)]),\n","                                    (N_obser-np.sum([tran2[i][i] for i in range(dim_obser)]))/N_obser*100) )\n","haha2 = tran2/np.sum(tran2,axis=1).reshape([dim_obser,1]).dot(np.ones([1,dim_obser]))\n","\n","for i in range(len(haha2)):\n","  print('{:.3f} {:.3f} {:.3f} {:.3f}'.format(haha2[i,0],haha2[i,1],haha2[i,2],haha2[i,3]))"]},{"cell_type":"code","execution_count":8,"metadata":{"executionInfo":{"elapsed":9,"status":"ok","timestamp":1652880565551,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"4KKOz64fGowY"},"outputs":[],"source":["# (Ni_fmcd[np.where(hidstate==1)].reshape([35,-1])).T,market[np.where(hidstate==1)].reshape([35,-1]).T#.reshape(-1)"]},{"cell_type":"code","execution_count":9,"metadata":{"executionInfo":{"elapsed":9,"status":"ok","timestamp":1652880565552,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"g9QRpVpC9uxe"},"outputs":[],"source":["import itertools\n","dim_action = 3\n","\n","fni_mcd,bni_mcd = (Ni_fmcd[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Ni_mcd[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fni_aw,bni_aw= (Ni_faw[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Ni_aw[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fni_bk,bni_bk= (Ni_fbk[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Ni_bk[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fni_harv,bni_harv =(Ni_fhvy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Ni_hvy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fni_wend,bni_wend = (Ni_fwdy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Ni_wdy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fni = [fni_mcd,fni_aw,fni_bk,fni_harv,fni_wend]\n","bni = [bni_mcd,bni_aw,bni_bk,bni_harv,bni_wend]\n","\n","\n","fnj_mcd,bnj_mcd = (Nj_fmcd[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Nj_mcd[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fnj_aw,bnj_aw= (Nj_faw[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Nj_aw[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fnj_bk,bnj_bk= (Nj_fbk[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Nj_bk[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fnj_harv,bnj_harv = (Nj_fhvy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Nj_hvy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","fnj_wend,bnj_wend = (Nj_fwdy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1),(Nj_wdy[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n"]},{"cell_type":"code","execution_count":10,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":8,"status":"ok","timestamp":1652880565552,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"UQJrHZWqJH3H","outputId":"13484e1f-5b64-4970-8308-12091b984e52"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["array([-1, -1, -1, ...,  1,  1,  1])"]},"metadata":{},"execution_count":10}],"source":["np.sort(np.int_(a_aw>0) - np.int_(a_aw<0))"]},{"cell_type":"code","execution_count":11,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1652880565552,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"nq8Trwm-APLj","outputId":"7fa1f3d6-3bc7-421d-e0d9-4924874f676a"},"outputs":[{"output_type":"stream","name":"stdout","text":["################################agent 1#######################################\n","action: -1\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","action: 0\n","7807&0&0&0\\\\\n","0&3337&0&0\\\\\n","0&0&483&0\\\\\n","0&0&0&31\\\\\n","action: 1\n","0&219&0&0\\\\\n","0&0&52&0\\\\\n","0&0&0&6\\\\\n","0&0&0&0\\\\\n","Stable term:11935 (100.00%)\n","[[[nan nan nan nan]\n","  [nan nan nan nan]\n","  [nan nan nan nan]\n","  [nan nan nan nan]]\n","\n"," [[ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [ 0.  0.  0.  1.]]\n","\n"," [[ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [ 0.  0.  0.  1.]\n","  [nan nan nan nan]]]\n","################################agent 2#######################################\n","action: -1\n","0&0&0&0\\\\\n","61&0&0&0\\\\\n","0&7&0&0\\\\\n","0&0&0&0\\\\\n","action: 0\n","10153&0&0&0\\\\\n","0&1476&0&0\\\\\n","0&0&104&0\\\\\n","0&0&0&0\\\\\n","action: 1\n","0&117&0&0\\\\\n","0&0&17&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","Stable term:11935 (100.00%)\n","[[[nan nan nan nan]\n","  [ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]\n","  [nan nan nan nan]]]\n","################################agent 3#######################################\n","action: -1\n","0&0&0&0\\\\\n","26&0&0&0\\\\\n","0&1&0&0\\\\\n","0&0&0&0\\\\\n","action: 0\n","11026&0&0&0\\\\\n","0&805&0&0\\\\\n","0&0&1&0\\\\\n","0&0&0&0\\\\\n","action: 1\n","0&74&0&0\\\\\n","0&0&2&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","Stable term:11935 (100.00%)\n","[[[nan nan nan nan]\n","  [ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]\n","  [nan nan nan nan]]]\n","################################agent 4#######################################\n","action: -1\n","0&0&0&0\\\\\n","40&0&0&0\\\\\n","0&6&0&0\\\\\n","0&0&0&0\\\\\n","action: 0\n","10447&0&0&0\\\\\n","0&1283&0&0\\\\\n","0&0&61&0\\\\\n","0&0&0&0\\\\\n","action: 1\n","0&85&0&0\\\\\n","0&0&13&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","Stable term:11935 (100.00%)\n","[[[nan nan nan nan]\n","  [ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]\n","  [nan nan nan nan]]]\n","################################agent 5#######################################\n","action: -1\n","0&0&0&0\\\\\n","9&0&0&0\\\\\n","0&1&0&0\\\\\n","0&0&0&0\\\\\n","action: 0\n","11109&0&0&0\\\\\n","0&722&0&0\\\\\n","0&0&21&0\\\\\n","0&0&0&0\\\\\n","action: 1\n","0&70&0&0\\\\\n","0&0&3&0\\\\\n","0&0&0&0\\\\\n","0&0&0&0\\\\\n","Stable term:11935 (100.00%)\n","[[[nan nan nan nan]\n","  [ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 1.  0.  0.  0.]\n","  [ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]]\n","\n"," [[ 0.  1.  0.  0.]\n","  [ 0.  0.  1.  0.]\n","  [nan nan nan nan]\n","  [nan nan nan nan]]]\n"]},{"output_type":"stream","name":"stderr","text":["/usr/local/lib/python3.7/dist-packages/ipykernel_launcher.py:32: RuntimeWarning: invalid value encountered in true_divide\n"]}],"source":["def GenerateAi(ai,hidstate=hidstate):\n","  ai_disc = np.int_(ai>0) - np.int_(ai<0)\n","  ai_disc = (ai_disc[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","  return ai_disc + 1\n","\n","ai_mcd = GenerateAi(a_mcd)\n","ai_aw = GenerateAi(a_aw)\n","ai_bk = GenerateAi(a_bk)\n","ai_harv = GenerateAi(a_hvy)\n","ai_wend = GenerateAi(a_wdy)\n","ai = [ai_mcd,ai_aw,ai_bk,ai_harv,ai_wend]\n","\n","obser = []\n","for j in range(5):\n","  print('################################agent {}#######################################'.format(j+1))\n","  obser_temp = np.zeros([dim_action,dim_obser,dim_obser],dtype=int)\n","  for i in range(len(fni[j])):\n","    obser_temp[ai[j][i],bni[j][i],fni[j][i]] +=1\n","  for i in range(dim_action):\n","    res = obser_temp[i]\n","    print('action:',i-1)\n","    PrintLatex(obser_temp[i])\n","  res = 0\n","  for a, z, z_prime in itertools.product(range(dim_action),range(dim_obser),range(dim_obser)):\n","      if z_prime == z + a-1:\n","        res += obser_temp[a,z,z_prime]\n","      elif z+a-1> dim_obser-1:\n","        res += obser_temp[a,z,-1]\n","      elif z+a-1<0:\n","        res += obser_temp[a,z,0]\n","  print('Stable term:{} ({:.2f}%)'.format(res, res/N_obser*100) )\n","  print(obser_temp/np.sum(obser_temp,axis=2).reshape([dim_action,dim_obser,1]).dot(np.ones([1,dim_obser])))\n","  obser.append(obser_temp)\n","\n"]},{"cell_type":"code","execution_count":12,"metadata":{"executionInfo":{"elapsed":448,"status":"ok","timestamp":1652880565996,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"l-L8Z7p6GJok"},"outputs":[],"source":["import pandas as pd\n","sample_id = (market[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","time_year = (year[np.where(hidstate==1)].reshape([35,-1]).T).reshape(-1)\n","dataFull = pd.DataFrame()\n","dataFull['sample_id'] = sample_id\n","dataFull['time_year'] = time_year\n","\n","dataFull['fni_mcd'] = fni_mcd\n","dataFull['fni_aw'] = fni_aw\n","dataFull['fni_bk'] = fni_bk\n","dataFull['fni_harv'] = fni_harv\n","dataFull['fni_wend'] = fni_wend\n","dataFull['bni_mcd'] = bni_mcd\n","dataFull['bni_aw'] = bni_aw\n","dataFull['bni_bk'] = bni_bk\n","dataFull['bni_harv'] = bni_harv\n","dataFull['bni_wend'] = bni_wend\n","\n","dataFull['fnj_mcd'] = fnj_mcd\n","dataFull['fnj_aw'] = fnj_aw\n","dataFull['fnj_bk'] = fnj_bk\n","dataFull['fnj_harv'] = fnj_harv\n","dataFull['fnj_wend'] = fnj_wend\n","dataFull['bnj_mcd'] = bnj_mcd\n","dataFull['bnj_aw'] = bnj_aw\n","dataFull['bnj_bk'] = bnj_bk\n","dataFull['bnj_harv'] = bnj_harv\n","dataFull['bnj_wend'] = bnj_wend\n","\n","dataFull['ai_mcd'] = ai_mcd\n","dataFull['ai_aw'] = ai_aw\n","dataFull['ai_bk'] = ai_bk\n","dataFull['ai_harv'] = ai_harv\n","dataFull['ai_wend'] = ai_wend\n","\n","dataFull['fs1'] = fs1\n","dataFull['bs1'] = bs1\n","dataFull['fs2'] = fs2\n","dataFull['bs2'] = bs2\n"]},{"cell_type":"code","execution_count":13,"metadata":{"colab":{"base_uri":"https://localhost:8080/","height":488},"executionInfo":{"elapsed":14,"status":"ok","timestamp":1652880565996,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"s-q9GAkp5DR1","outputId":"7958ac2e-00ea-4680-d678-2127e1620e03"},"outputs":[{"output_type":"execute_result","data":{"text/plain":["       sample_id  time_year  fni_mcd  fni_aw  fni_bk  fni_harv  fni_wend  \\\n","0              0       1970        0       0       0         0         0   \n","1              0       1971        0       0       0         0         0   \n","2              0       1972        0       0       0         0         0   \n","3              0       1973        0       0       0         0         0   \n","4              0       1974        0       0       0         0         0   \n","...          ...        ...      ...     ...     ...       ...       ...   \n","11930        398       2000        0       0       0         0         0   \n","11931        398       2001        0       0       0         0         0   \n","11932        398       2002        0       0       0         1         0   \n","11933        398       2003        0       0       0         1         0   \n","11934        398       2004        0       0       0         1         0   \n","\n","       bni_mcd  bni_aw  bni_bk  ...  bnj_wend  ai_mcd  ai_aw  ai_bk  ai_harv  \\\n","0            0       0       0  ...         0       1      1      1        1   \n","1            0       0       0  ...         0       1      1      1        1   \n","2            0       0       0  ...         0       1      1      1        1   \n","3            0       0       0  ...         0       1      1      1        1   \n","4            0       0       0  ...         0       1      1      1        1   \n","...        ...     ...     ...  ...       ...     ...    ...    ...      ...   \n","11930        0       0       0  ...         0       1      1      1        1   \n","11931        0       0       0  ...         0       1      1      1        1   \n","11932        0       0       0  ...         0       1      1      1        2   \n","11933        0       0       0  ...         1       1      1      1        1   \n","11934        0       0       0  ...         1       1      1      1        1   \n","\n","       ai_wend  fs1  bs1  fs2  bs2  \n","0            1    2    2    2    2  \n","1            1    2    2    2    2  \n","2            1    3    2    2    2  \n","3            1    3    3    2    2  \n","4            1    3    3    2    2  \n","...        ...  ...  ...  ...  ...  \n","11930        1    2    2    3    3  \n","11931        1    2    2    3    3  \n","11932        1    2    2    3    3  \n","11933        1    2    2    3    3  \n","11934        1    2    2    3    3  \n","\n","[11935 rows x 31 columns]"],"text/html":["\n","  <div id=\"df-f6d17f7d-218d-4262-bb32-10164f1c8eda\">\n","    <div class=\"colab-df-container\">\n","      <div>\n","<style scoped>\n","    .dataframe tbody tr th:only-of-type {\n","        vertical-align: middle;\n","    }\n","\n","    .dataframe tbody tr th {\n","        vertical-align: top;\n","    }\n","\n","    .dataframe thead th {\n","        text-align: right;\n","    }\n","</style>\n","<table border=\"1\" class=\"dataframe\">\n","  <thead>\n","    <tr style=\"text-align: right;\">\n","      <th></th>\n","      <th>sample_id</th>\n","      <th>time_year</th>\n","      <th>fni_mcd</th>\n","      <th>fni_aw</th>\n","      <th>fni_bk</th>\n","      <th>fni_harv</th>\n","      <th>fni_wend</th>\n","      <th>bni_mcd</th>\n","      <th>bni_aw</th>\n","      <th>bni_bk</th>\n","      <th>...</th>\n","      <th>bnj_wend</th>\n","      <th>ai_mcd</th>\n","      <th>ai_aw</th>\n","      <th>ai_bk</th>\n","      <th>ai_harv</th>\n","      <th>ai_wend</th>\n","      <th>fs1</th>\n","      <th>bs1</th>\n","      <th>fs2</th>\n","      <th>bs2</th>\n","    </tr>\n","  </thead>\n","  <tbody>\n","    <tr>\n","      <th>0</th>\n","      <td>0</td>\n","      <td>1970</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>1</th>\n","      <td>0</td>\n","      <td>1971</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>2</th>\n","      <td>0</td>\n","      <td>1972</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>3</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>3</th>\n","      <td>0</td>\n","      <td>1973</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>3</td>\n","      <td>3</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>4</th>\n","      <td>0</td>\n","      <td>1974</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>3</td>\n","      <td>3</td>\n","      <td>2</td>\n","      <td>2</td>\n","    </tr>\n","    <tr>\n","      <th>...</th>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","      <td>...</td>\n","    </tr>\n","    <tr>\n","      <th>11930</th>\n","      <td>398</td>\n","      <td>2000</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>11931</th>\n","      <td>398</td>\n","      <td>2001</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>11932</th>\n","      <td>398</td>\n","      <td>2002</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>11933</th>\n","      <td>398</td>\n","      <td>2003</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>3</td>\n","    </tr>\n","    <tr>\n","      <th>11934</th>\n","      <td>398</td>\n","      <td>2004</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>1</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>0</td>\n","      <td>...</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>1</td>\n","      <td>2</td>\n","      <td>2</td>\n","      <td>3</td>\n","      <td>3</td>\n","    </tr>\n","  </tbody>\n","</table>\n","<p>11935 rows × 31 columns</p>\n","</div>\n","      <button class=\"colab-df-convert\" onclick=\"convertToInteractive('df-f6d17f7d-218d-4262-bb32-10164f1c8eda')\"\n","              title=\"Convert this dataframe to an interactive table.\"\n","              style=\"display:none;\">\n","        \n","  <svg xmlns=\"http://www.w3.org/2000/svg\" height=\"24px\"viewBox=\"0 0 24 24\"\n","       width=\"24px\">\n","    <path d=\"M0 0h24v24H0V0z\" fill=\"none\"/>\n","    <path d=\"M18.56 5.44l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94zm-11 1L8.5 8.5l.94-2.06 2.06-.94-2.06-.94L8.5 2.5l-.94 2.06-2.06.94zm10 10l.94 2.06.94-2.06 2.06-.94-2.06-.94-.94-2.06-.94 2.06-2.06.94z\"/><path d=\"M17.41 7.96l-1.37-1.37c-.4-.4-.92-.59-1.43-.59-.52 0-1.04.2-1.43.59L10.3 9.45l-7.72 7.72c-.78.78-.78 2.05 0 2.83L4 21.41c.39.39.9.59 1.41.59.51 0 1.02-.2 1.41-.59l7.78-7.78 2.81-2.81c.8-.78.8-2.07 0-2.86zM5.41 20L4 18.59l7.72-7.72 1.47 1.35L5.41 20z\"/>\n","  </svg>\n","      </button>\n","      \n","  <style>\n","    .colab-df-container {\n","      display:flex;\n","      flex-wrap:wrap;\n","      gap: 12px;\n","    }\n","\n","    .colab-df-convert {\n","      background-color: #E8F0FE;\n","      border: none;\n","      border-radius: 50%;\n","      cursor: pointer;\n","      display: none;\n","      fill: #1967D2;\n","      height: 32px;\n","      padding: 0 0 0 0;\n","      width: 32px;\n","    }\n","\n","    .colab-df-convert:hover {\n","      background-color: #E2EBFA;\n","      box-shadow: 0px 1px 2px rgba(60, 64, 67, 0.3), 0px 1px 3px 1px rgba(60, 64, 67, 0.15);\n","      fill: #174EA6;\n","    }\n","\n","    [theme=dark] .colab-df-convert {\n","      background-color: #3B4455;\n","      fill: #D2E3FC;\n","    }\n","\n","    [theme=dark] .colab-df-convert:hover {\n","      background-color: #434B5C;\n","      box-shadow: 0px 1px 3px 1px rgba(0, 0, 0, 0.15);\n","      filter: drop-shadow(0px 1px 2px rgba(0, 0, 0, 0.3));\n","      fill: #FFFFFF;\n","    }\n","  </style>\n","\n","      <script>\n","        const buttonEl =\n","          document.querySelector('#df-f6d17f7d-218d-4262-bb32-10164f1c8eda button.colab-df-convert');\n","        buttonEl.style.display =\n","          google.colab.kernel.accessAllowed ? 'block' : 'none';\n","\n","        async function convertToInteractive(key) {\n","          const element = document.querySelector('#df-f6d17f7d-218d-4262-bb32-10164f1c8eda');\n","          const dataTable =\n","            await google.colab.kernel.invokeFunction('convertToInteractive',\n","                                                     [key], {});\n","          if (!dataTable) return;\n","\n","          const docLinkHtml = 'Like what you see? Visit the ' +\n","            '<a target=\"_blank\" href=https://colab.research.google.com/notebooks/data_table.ipynb>data table notebook</a>'\n","            + ' to learn more about interactive tables.';\n","          element.innerHTML = '';\n","          dataTable['output_type'] = 'display_data';\n","          await google.colab.output.renderOutput(dataTable, element);\n","          const docLink = document.createElement('div');\n","          docLink.innerHTML = docLinkHtml;\n","          element.appendChild(docLink);\n","        }\n","      </script>\n","    </div>\n","  </div>\n","  "]},"metadata":{},"execution_count":13}],"source":["#dataFull.to_csv('dataFull.csv')\n","dataFull"]},{"cell_type":"code","execution_count":14,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":11,"status":"ok","timestamp":1652880565997,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"SP_pOJuA23DZ","outputId":"4df07d1c-b7f4-4b77-d267-e2659a4d0baa"},"outputs":[{"output_type":"stream","name":"stdout","text":["(36, 341) (36, 341) (35, 341)\n"]}],"source":["data_sp = 341\n","data_tm = 35\n","def GenerateOS(bni,fni,bnj,fnj,bs1=bs1,fs1=fs1,data_sp=data_sp,data_tm=data_tm):\n","  data_osb = bni * 16 + bnj*4 + bs1\n","  data_osb = data_osb.reshape([data_sp,data_tm]).T\n","  data_osf = fni * 16 + fnj*4 + fs1\n","  data_osf = data_osf.reshape([data_sp,data_tm]).T\n","  data_os = np.vstack([data_osb,data_osf[-1,:]])\n","  return data_os\n","data_os_mcd = GenerateOS(bni_mcd,fni_mcd,bnj_mcd,fnj_mcd)\n","data_os_aw = GenerateOS(bni_aw,fni_aw,bnj_aw,fnj_aw)\n","data_os_bk = GenerateOS(bni_bk,fni_bk,bnj_bk,fnj_bk)\n","data_os_harv = GenerateOS(bni_harv,fni_harv,bnj_harv,fnj_harv)\n","data_os_wend = GenerateOS(bni_wend,fni_wend,bnj_wend,fnj_wend)\n","\n","data_zb = bs2\n","data_zb = data_zb.reshape([data_sp,data_tm]).T\n","data_zf = fs2\n","data_zf = data_zf.reshape([data_sp,data_tm]).T\n","data_z = np.vstack([data_zb,data_zf[-1,:]])\n","\n","data_ai_mcd = ai_mcd.reshape([data_sp,data_tm]).T\n","data_ai_aw = ai_aw.reshape([data_sp,data_tm]).T\n","data_ai_bk = ai_bk.reshape([data_sp,data_tm]).T\n","data_ai_harv = ai_harv.reshape([data_sp,data_tm]).T\n","data_ai_wend = ai_wend.reshape([data_sp,data_tm]).T\n","\n","print(data_os_mcd.shape,data_z.shape,data_ai_mcd.shape)"]},{"cell_type":"code","execution_count":15,"metadata":{"executionInfo":{"elapsed":8,"status":"ok","timestamp":1652880565997,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"6LYboNvZ1FhY"},"outputs":[],"source":["data_os = [data_os_mcd[0:-1],data_os_aw[0:-1],data_os_bk[0:-1],data_os_harv[0:-1],data_os_wend[0:-1]]\n","data_bz=data_z[0:-1]\n","data_ai = [data_ai_mcd,data_ai_aw,data_ai_bk,data_ai_harv,data_ai_wend]"]},{"cell_type":"markdown","metadata":{"id":"aJjHO7_6hNZj"},"source":["#3. Recover Process (Complete Initial Verison)"]},{"cell_type":"code","execution_count":16,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":7,"status":"ok","timestamp":1652880565997,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"Ir8S4K8uiSB2","outputId":"90cbcaec-b721-4f11-b7fc-66721a58bbf8"},"outputs":[{"output_type":"stream","name":"stdout","text":["[ 0. -0. -0.  0. -0.  0.  0. -0. -0. -0. -0.  0.]\n"]}],"source":["print(theta1)"]},{"cell_type":"code","execution_count":17,"metadata":{"executionInfo":{"elapsed":3,"status":"ok","timestamp":1652880566150,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"kqXSEH3shUbb"},"outputs":[],"source":["def DynamicSo(tran1=tran1): # a1*3+a2, n1*16+n2*4+pop\n","  obser_ni = np.zeros([dim_action,dim_observe,dim_observe]) #ai, ni, ni'\n","  #obser_nj = np.zeros([dim_action,dim_observe,dim_observe]) #a2, n2, n2'\n","  obser_pop = np.zeros([dim_observe,dim_observe]) #pop, pop'\n","  for a, z, z_prime in itertools.product(range(dim_action),range(dim_observe),range(dim_observe)):\n","    if z_prime == z + a-1:\n","      obser_ni[a,z,z_prime] = 1\n","    elif z+a-1> dim_observe-1:\n","      obser_ni[a,z,-1] = 1\n","    elif z+a-1<0:\n","      obser_ni[a,z,0]  = 1\n","  obser_pop = tran1/np.sum(tran1,axis=1).reshape([dim_obser,1]).dot(np.ones([1,dim_obser]))\n","  obser_ni_final = obser_ni[:,ni_old,:][:,:,ni_old] #a, so, so'\n","  obser_pop_final = np.stack([obser_pop for i in range(dim_action)],axis=0)#print(obser_pop[0])\n","  obser_pop_final = obser_pop_final[:,pop_old,:][:,:,pop_old]\n","  return obser_pop_final*obser_ni_final,[obser_pop,obser_ni]#,obser_nj]\n","obserSo, [obser_pop,obser_ni] = DynamicSo() # ai, ni_old *16 + nj_old *4 + pop_old,ni_new *16 + nj_new *4 + pop_new \n","def RewardCom(theta1,ni_old = ni_old,nj_old=nj_old,pop_old=pop_old): #2, 4*4*4, 3\n","    rw_mcd = np.zeros([dim_ostate,dim_observe,dim_action])#st,z,a_{t,1}\n","    rw_other = np.zeros([dim_ostate,dim_observe,dim_action])#st,z,a_{t,2}\n","    for ai in range(dim_action):\n","      for z in range(dim_observe):\n","        rw_mcd[:,z,ai] = ni_old * theta1[0] + ni_old *ni_old * theta1[1] + ni_old*nj_old * theta1[2]+ni_old*pop_old * theta1[3]  +ni_old*z * theta1[4] - (ai==2) *theta1[5]  \n","        rw_other[:,z,ai] = ni_old * theta1[6] + ni_old *ni_old * theta1[7] + ni_old*nj_old * theta1[8]+ni_old*pop_old * theta1[9] +ni_old*z * theta1[10] - (ai==2) *theta1[11]                                                  \n","    return rw_mcd,rw_other\n","#print(RewardCom(theta1))#[0].shape)\n","rw_mcd,rw_other = RewardCom(theta1)\n","\n","def DynamicCom(tran2=tran2):\n","  trans = tran2/np.sum(tran2,axis=1).reshape([dim_obser,1]).dot(np.ones([1,dim_obser]))\n","  return trans\n","trans = DynamicCom()\n"]},{"cell_type":"code","execution_count":18,"metadata":{"executionInfo":{"elapsed":445,"status":"ok","timestamp":1652880566593,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"FhtkY6IPLTRs"},"outputs":[],"source":["#  for ni = 0:3\n","#         for z1 = 0:3\n","def GeneratePnj(pi_mcd,pi_other,ni=ni_old,z1=pop_old):\n","  #ni = ni_old\n","  #z1 = pop_old\n","  fnj_mcd_temp = np.zeros([dim_ostate,dim_obser,dim_obser]) # ni_mcd_old *16 + nj_mcd_old *4 + pop_old , income_old, nj_mcd_new\n","  fnj_other_temp = np.zeros([dim_ostate,dim_obser,dim_obser]) # ni_mcd_old *16 + nj_mcd_old *4 + pop_old , income_old, nj_mcd_new\n","\n","  for z2 in range(dim_obser):\n","      \n","      nj = 0         # If today's # of rivals = 0\n","      x =  (4*4)*ni+ 4*nj + z1  # index of today's own state\n","      x0 = (4*4)*0 + 4*ni + z1  # index of today's state for rivals with 0 shops\n","      fnj_mcd_temp[x,z2,0] =   pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 0) from McD's perspective\n","      fnj_mcd_temp[x,z2,1] = 4*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 1) from McD's perspective\n","      fnj_mcd_temp[x,z2,2] = 6*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 2) from McD's perspective\n","      fnj_mcd_temp[x,z2,3] = 4*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]   # Prob(Nj'= 3) from McD's perspective \n","      fnj_other_temp[x,z2,0] =  pi_mcd[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]    # Prob(Nj'= 0) from Others' perspectives\n","      fnj_other_temp[x,z2,1] =  pi_mcd[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          3*pi_mcd[x0,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]    # Prob(Nj'= 1) from Others's perspective\n","      fnj_other_temp[x,z2,2] =3*pi_mcd[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          3*pi_mcd[x0,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]    # Prob(Nj'= 2) from Others's perspective\n","      fnj_other_temp[x,z2,3] =3*pi_mcd[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1] +\\\n","                            pi_mcd[x0,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,2]    # Prob(Nj'= 3) from Others's perspective\n","      \n","      nj = 1         # If today's # of rivals = 1\n","      x =  (4*4)*ni+ 4*nj + z1  # index of today's own state\n","      x0 = (4*4)*0 + 4*ni + z1  # index of today's state for rivals with 0 shops\n","      x1 = (4*4)*1 + 4*ni + z1  # index of today's state for rivals with 1 shops\n","      fnj_mcd_temp[x,z2,0] =   pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 0) from McD's perspective\n","      fnj_mcd_temp[x,z2,1] =   pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 1) from McD's perspective\n","      fnj_mcd_temp[x,z2,2] =   pi_other[x1,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                        3*pi_other[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 2) from McD's perspective\n","      fnj_mcd_temp[x,z2,3] = 3*pi_other[x1,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                        3*pi_other[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]   # Prob(Nj'= 3) from McD's perspective\n","      fnj_other_temp[x,z2,0] =0.5*pi_mcd[x0,z2,1]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*pi_mcd[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]    # Prob(Nj'= 0) from Others' perspectives\n","      fnj_other_temp[x,z2,1] =0.5*pi_mcd[x0,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*pi_mcd[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]    # Prob(Nj'= 1) from Others's perspective\n","      fnj_other_temp[x,z2,2] =0.5  *pi_mcd[x0,z2,2]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x0,z2,1]*pi_other[x1,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*2*pi_mcd[x0,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x1,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*3*pi_mcd[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]  # Prob(Nj'= 2) from Others's perspective\n","      fnj_other_temp[x,z2,3] =0.5  *pi_mcd[x0,z2,2]*pi_other[x1,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*2*pi_mcd[x0,z2,2]*pi_other[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1] +\\\n","                          0.5*2*pi_mcd[x0,z2,1]*pi_other[x1,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x0,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,2] +\\\n","                          0.5*3*pi_mcd[x1,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*3*pi_mcd[x1,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,2]*pi_other[x0,z2,1]  # Prob(Nj'= 3) from Others's perspective\n","\n","      nj = 2         # If today's # of rivals = 2\n","      x =  (4*4)*ni+ 4*nj + z1  # index of today's own state\n","      x0 = (4*4)*0 + 4*ni + z1  # index of today's state for rivals with 0 shops\n","      x1 = (4*4)*1 + 4*ni + z1  # index of today's state for rivals with 1 shops\n","      x2 = (4*4)*2 + 4*ni + z1  # index of today's state for rivals with 2 shops\n","      fnj_mcd_temp[x,z2,0] =   pi_other[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]      # Prob(Nj'= 0) from McD's perspective\n","      fnj_mcd_temp[x,z2,1] =(2/3)*pi_other[x1,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                        (1/3)*pi_other[x2,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 1) from McD's perspective\n","      fnj_mcd_temp[x,z2,2] =(2/3)*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                        (1/3)*pi_other[x2,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 2) from McD's perspective\n","      fnj_mcd_temp[x,z2,3] =(1/3)*pi_other[x2,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                        (1/3)*3*pi_other[x2,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] # Prob(Nj'= 3) from McD's perspective\n","      fnj_other_temp[x,z2,0] =0.5*pi_mcd[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]     # Prob(Nj'= 0) from Others' perspectives\n","      fnj_other_temp[x,z2,1] =0.5*pi_mcd[x2,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*(pi_mcd[x1,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                              pi_mcd[x1,z2,1]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1])   # Prob(Nj'= 1) from Others's perspective\n","      fnj_other_temp[x,z2,2] =0.5  *pi_mcd[x2,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 2) from Others's perspective\n","      fnj_other_temp[x,z2,3] =0.5  *pi_mcd[x2,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*3*pi_mcd[x2,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x1,z2,2]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5  *pi_mcd[x1,z2,1]*pi_other[x1,z2,2]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.5*2*pi_mcd[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,2]*pi_other[x0,z2,1]   # Prob(Nj'= 3) from Others's perspective\n","\n","      nj = 3         # If today's # of rivals = 3\n","      x =  (4*4)*ni+ 4*nj + z1  # index of today's own state\n","      x0 = (4*4)*0 + 4*ni + z1  # index of today's state for rivals with 0 shops\n","      x1 = (4*4)*1 + 4*ni + z1  # index of today's state for rivals with 1 shops\n","      x2 = (4*4)*2 + 4*ni + z1  # index of today's state for rivals with 2 shops\n","      x3 = (4*4)*3 + 4*ni + z1  # index of today's state for rivals with 3 shops\n","      fnj_mcd_temp[x,z2,0] =(2/3)*pi_other[x0,z2,1]*pi_other[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x1,z2,0]   # Prob(Nj'= 0) from McD's perspective\n","      fnj_mcd_temp[x,z2,1] =(2/3)*pi_other[x1,z2,1]*pi_other[x1,z2,0]*pi_other[x1,z2,0]+\\\n","                        (1/3)*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x1,z2,0]*pi_other[x2,z2,0]   # Prob(Nj'= 1) from McD's perspective\n","      fnj_mcd_temp[x,z2,2] =(2/3)*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x1,z2,0]+\\\n","                        (1/3)*(pi_other[x2,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]+\\\n","                              pi_other[x2,z2,1]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]) # Prob(Nj'= 2) from McD's perspective\n","      fnj_mcd_temp[x,z2,3] =(2/3)*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]+\\\n","                        (1/3)*pi_other[x2,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 3) from McD's perspective\n","      fnj_other_temp[x,z2,0] =0.25*pi_mcd[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x0,z2,1]     # Prob(Nj'= 0) from Others' perspectives\n","      fnj_other_temp[x,z2,1] =0.25*pi_mcd[x2,z2,0]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25*(2*pi_mcd[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1]+\\\n","                              pi_mcd[x1,z2,1]*pi_other[x1,z2,0]*pi_other[x1,z2,0]*pi_other[x0,z2,1])+\\\n","                          0.25*pi_mcd[x1,z2,0]*pi_other[x2,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]     # Prob(Nj'= 1) from Others's perspective\n","      fnj_other_temp[x,z2,2] =0.25  *pi_mcd[x3,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x2,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x2,z2,1]*pi_other[x1,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x1,z2,0]*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25*2*pi_mcd[x1,z2,1]*pi_other[x1,z2,0]*pi_other[x1,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x1,z2,0]*pi_other[x2,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x1,z2,1]*pi_other[x2,z2,0]*pi_other[x0,z2,1]*pi_other[x0,z2,1]   # Prob(Nj'= 2) from Others's perspective\n","      fnj_other_temp[x,z2,3] =0.25  *pi_mcd[x3,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x2,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x0,z2,1] +\\\n","                          0.25  *pi_mcd[x0,z2,1]*pi_other[x1,z2,1]*pi_other[x1,z2,1]*pi_other[x1,z2,1]   # Prob(Nj'= 3) from Others's perspective\n","      \n","\n","  Denom_mcd = np.stack([np.sum(fnj_mcd_temp,2) for i in range(dim_observe)],axis=2) #Sum of each row\n","  fnj_mcd_temp = fnj_mcd_temp / Denom_mcd#;                 % Make sure each row sums up to 1\n","  fnj_mcd_temp[np.isnan(fnj_mcd_temp)] = 0#;                    % Replace NaN with 0\n","  # F_Nj(1,j,:,:,mtype) = ...\n","  #     [fnj_mcd(:,1) * ones(1,16), fnj_mcd(:,2) * ones(1,16), fnj_mcd(:,3) * ones(1,16), fnj_mcd(:,4) * ones(1,16),...\n","  #       fnj_mcd(:,1) * ones(1,16), fnj_mcd(:,2) * ones(1,16), fnj_mcd(:,3) * ones(1,16), fnj_mcd(:,4) * ones(1,16),...\n","  #       fnj_mcd(:,1) * ones(1,16), fnj_mcd(:,2) * ones(1,16), fnj_mcd(:,3) * ones(1,16), fnj_mcd(:,4) * ones(1,16),...\n","  #       fnj_mcd(:,1) * ones(1,16), fnj_mcd(:,2) * ones(1,16), fnj_mcd(:,3) * ones(1,16), fnj_mcd(:,4) * ones(1,16)];\n","\n","  Denom_other = np.stack([np.sum(fnj_other_temp,2) for i in range(dim_observe)],axis=2)# % Sum of each row\n","  fnj_other_temp = fnj_other_temp / Denom_other#;                   % Make sure each row sums up to 1\n","  fnj_other_temp[np.isnan(fnj_other_temp)] = 0#;                        % Replace NaN with 0\n","  # F_Nj(2,j,:,:,mtype) = ...\n","  #     [fnj_other(:,1) * ones(1,16), fnj_other(:,2) * ones(1,16), fnj_other(:,3) * ones(1,16), fnj_other(:,4) * ones(1,16),...\n","  #       fnj_other(:,1) * ones(1,16), fnj_other(:,2) * ones(1,16), fnj_other(:,3) * ones(1,16), fnj_other(:,4) * ones(1,16),...\n","  #       fnj_other(:,1) * ones(1,16), fnj_other(:,2) * ones(1,16), fnj_other(:,3) * ones(1,16), fnj_other(:,4) * ones(1,16),...\n","  #       fnj_other(:,1) * ones(1,16), fnj_other(:,2) * ones(1,16), fnj_other(:,3) * ones(1,16), fnj_other(:,4) * ones(1,16)];\n","  # F_Nj(3:5,j,:,:,mtype) = repmat(F_Nj(2,j,:,:,mtype), [3, 1, 1, 1, 1]);    % Other 4 chains are symmetric\n","  return fnj_mcd_temp[:,:,nj_old],fnj_other_temp[:,:,nj_old]"]},{"cell_type":"code","execution_count":19,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"executionInfo":{"elapsed":993,"status":"ok","timestamp":1652880567585,"user":{"displayName":"Lu Sun","userId":"12220989488268625125"},"user_tz":300},"id":"_dqpwP9hLIwU","outputId":"6f9160d0-4203-4d34-a6c9-c2481db418b6"},"outputs":[{"output_type":"stream","name":"stdout","text":["0.8272593021392822\n"]}],"source":["from scipy.special import logsumexp\n","from scipy.special import softmax\n","\n","def ValueIterationCom(theta1,trans,obserSo, beta = 0.9, #xt,a_t,z_t,z_{t+1}\n","                   gamma = 0.5772,thread_inner = 1e-3,thread_outer = 1e-2): #xt,z, a1 or xt,z, a2\n","  rw1_belief,rw2_belief = RewardCom(theta1)#, Reward(theta1,2) #st,z,a_{t,1}\n","\n","\n","  pi1_new = 1/dim_action*np.ones([dim_ostate,dim_observe,dim_action]) #xt,za,a1\n","  pi2_old = pi1_new.copy()\n","\n","  a_old = np.arange(dim_action,dtype=int)\n","\n","  Q1_new = np.zeros([dim_ostate,dim_observe,dim_action]) #xt,za,a1#rw1_belief#\n","  Q2_new = np.zeros([dim_ostate,dim_observe,dim_action]) #xt,za,a2#rw2_belief#\n","\n","  for ol in range(1000):\n","    pi1_old = pi1_new.copy()\n","\n","    # Q1_new = np.zeros([dim_statefull,dim_action]) #xt,za,a1#rw1_belief#\n","    # Q2_new = np.zeros([dim_statefull,dim_action]) #xt,za,a2#rw2_belief#\n","    for il in range(1000):\n","      Q2_old = Q2_new.copy() #xt,za,a2\n","      #a_belief = a_old * dim_action + a2\n","      V2 = gamma + logsumexp(Q2_old,axis=2) #so_new,z_new\n","      V2 = np.kron(np.ones([dim_ostate,dim_observe,1,1]),V2.reshape([1,1,dim_ostate,dim_observe])) #so_old,z_old,so_new,z_new\n","      _,fnj_other_temp = GeneratePnj(pi1_old,softmax(Q2_old,axis=2)) # so_old,z_old, so_new\n","      \n","      for a2 in range(dim_action):\n","        V2_temp = np.zeros([dim_ostate,dim_observe,dim_ostate,dim_observe])\n","        for zt,zt1 in itertools.product(range(dim_observe),range(dim_observe)):\n","          V2_temp[:,zt,:,zt1] = trans[zt,zt1] * V2[:,zt,:,zt1] * obserSo[a2,:,:] * fnj_other_temp[:,zt,:] #so_old,so_new\n","        V2_temp = np.sum(np.sum(V2_temp,axis=3),axis=2) # so_old,z_old \n","        Q2_new[:,:,a2] = rw2_belief[:,:,a2] + beta * V2_temp #x_old.dot(rw2[0,:,a2].reshape([1,-1])) + (1-x_old).dot(rw2[1,:,a2].reshape([1,-1])) \n","      \n","      if ol==0 and il==0:\n","        error_in2 = 1\n","      else:\n","        error_in2 = np.max(np.abs(np.nan_to_num((Q2_new-Q2_old)/Q2_old)))\n","      #print('Q2',il,error_in2,np.max(np.abs(Q2_old)))\n","      if  error_in2<thread_inner: \n","        #print('Q2',il,error_in2,np.max(np.abs(Q2_old)))\n","        break\n","\n","    pi2_new = softmax(Q2_new,axis=2)   \n","    error_ot2 = np.max(np.abs(np.nan_to_num((pi2_old-pi2_new)/pi2_old)))\n","\n","\n","    pi2_old = pi2_new.copy()\n","    for il in range(1000):\n","      Q1_old = Q1_new.copy() #xt,za,a2\n","      #a_belief = a1 * dim_action + a_old\n","      V1 = gamma + logsumexp(Q1_old,axis=2)\n","      V1 = np.kron(np.ones([dim_ostate,dim_observe,1,1]),V1.reshape([1,1,dim_ostate,dim_observe]))\n","      fnj_mcd_temp,_ = GeneratePnj(softmax(Q1_old,axis=2),pi2_old) # so_old,z_old, so_new\n","\n","      for a1 in range(dim_action):\n","        V1_temp = np.zeros([dim_ostate,dim_observe,dim_ostate,dim_observe])\n","        for zt,zt1 in itertools.product(range(dim_observe),range(dim_observe)):\n","          V1_temp[:,zt,:,zt1] = trans[zt,zt1] * V1[:,zt,:,zt1] * obserSo[a1,:,:]*fnj_mcd_temp[:,zt,:]  #so_old,so_new\n","\n","        V1_temp = np.sum(np.sum(V1_temp,axis=3),axis=2) #[x_old,a1,z_old]\n","        Q1_new[:,:,a1] = rw1_belief[:,:,a1] + beta * V1_temp #x_old.dot(rw2[0,:,a2].reshape([1,-1])) + (1-x_old).dot(rw2[1,:,a2].reshape([1,-1])) \n","      if ol==0 and il==0:\n","        error_in1 =1\n","      else:\n","        error_in1 = np.max(np.abs(np.nan_to_num((Q1_new-Q1_old)/Q1_old)))\n","      #print('Q1',il,error_in1,np.max(np.abs(Q1_old)))\n","      if  error_in1<thread_inner: \n","        #print('Q1',il,error_in1,np.max(np.abs(Q1_old)))\n","        break\n","\n","    pi1_new = softmax(Q1_new,axis=2)   \n","    error_ot1 = np.max(np.abs(np.nan_to_num((pi1_old-pi1_new)/pi1_old)))\n","\n","    #print(ol,error_ot1,error_ot2)\n","    if error_ot1 <thread_outer and error_ot2<thread_outer:\n","      #print(ol,error_ot1,error_ot2)\n","      break\n","  return Q1_new,Q2_new,pi1_new,pi2_new\n","\n","\n","import time\n","start = time.time()\n","Q1,Q2,pi1,pi2 = ValueIterationCom(theta1,trans,obserSo)\n","print(time.time()-start)"]},{"cell_type":"code","execution_count":null,"metadata":{"colab":{"base_uri":"https://localhost:8080/"},"id":"PEOARlvcor0R","outputId":"c53df49e-321e-4327-bd01-768c18e29ef2"},"outputs":[{"output_type":"stream","name":"stdout","text":["start from: [ 0. -0. -0.  0. -0.  0.  0. -0. -0. -0. -0.  0.]\n","[ 0. -0. -0.  0. -0.  0.  0. -0. -0. -0. -0.  0.] 65559.68832626948\n","[ 0. -0. -0.  0. -0.  0.  0. -0. -0. -0. -0.  0.] 65559.68832626948\n","[1.49011612e-08 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68844144864\n","[0.00000000e+00 1.49011612e-08 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68862659264\n","[0.00000000e+00 0.00000000e+00 1.49011612e-08 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68853734825\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 1.49011612e-08\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68850675382\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 1.49011612e-08 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68850557851\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 1.49011612e-08 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68827111529\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 1.49011612e-08 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68895571574\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 1.49011612e-08\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68973191301\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 1.49011612e-08 0.00000000e+00 0.00000000e+00 0.00000000e+00] 65559.68961136244\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 1.49011612e-08 0.00000000e+00 0.00000000e+00] 65559.6893478238\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 1.49011612e-08 0.00000000e+00] 65559.68936990277\n","[0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 0.00000000e+00\n"," 0.00000000e+00 0.00000000e+00 0.00000000e+00 1.49011612e-08] 65559.68809481962\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39040064135\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39040064135\n","[-0.04589215 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39038476573\n","[-0.04589217 -0.11966123 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39037649796\n","[-0.04589217 -0.11966124 -0.08410255 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39039861843\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191246 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.390362720624\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144416  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.3903549372\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197574\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.390374979106\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079756 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.39035802591\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006684 -0.51203449 -0.40702974 -0.41582692  0.09221925] 58745.390352123046\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203448 -0.40702974 -0.41582692  0.09221925] 58745.39037625234\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702972 -0.41582692  0.09221925] 58745.3903242972\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.4158269   0.09221925] 58745.390310664705\n","[-0.04589217 -0.11966124 -0.08410256 -0.07191247 -0.07144417  0.02197573\n"," -0.25079757 -0.56006685 -0.51203449 -0.40702974 -0.41582692  0.09221927] 58745.3903810419\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70938832548\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70938832548\n","[-0.03296331 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.709384511574\n","[-0.03296333 -0.10443874 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70938358263\n","[-0.03296333 -0.10443876 -0.08942158 -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70938821057\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767372 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.709371835415\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882205  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70936580409\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143494\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70935882909\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745223 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.709347586715\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792729 -0.53147893 -0.36144475 -0.3564148   0.12143408] 57842.70934168897\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147892 -0.36144475 -0.3564148   0.12143408] 57842.70936181318\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144473 -0.3564148   0.12143408] 57842.70931540908\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.35641478  0.12143408] 57842.709302113\n","[-0.03296333 -0.10443876 -0.0894216  -0.03767374 -0.02882207  0.05143492\n"," -0.22745225 -0.55792731 -0.53147893 -0.36144475 -0.3564148   0.1214341 ] 57842.70936699834\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61344819103\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61344819103\n","[-0.02303188 -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61346761911\n","[-0.0230319  -0.10099341 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.613488242576\n","[-0.0230319  -0.10099343 -0.1042101   0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61345245682\n","[-0.0230319  -0.10099343 -0.10421011  0.00630866  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.613478336665\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.03178961  0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61347710455\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700068\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61341333714\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287182 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61341321252\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939938 -0.56724075 -0.25545782 -0.21844364  0.19191249] 56251.61340734202\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724073 -0.25545782 -0.21844364  0.19191249] 56251.61341972428\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.2554578  -0.21844364  0.19191249] 56251.61338559624\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844362  0.19191249] 56251.61337313225\n","[-0.0230319  -0.10099343 -0.10421011  0.00630864  0.0317896   0.12700067\n"," -0.17287184 -0.54939939 -0.56724075 -0.25545782 -0.21844364  0.1919125 ] 56251.61342170887\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47763247733\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47763247733\n","[-0.02536063 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47765716032\n","[-0.02536065 -0.14360149 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.4776877932\n","[-0.02536065 -0.14360151 -0.13944002  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47764215579\n","[-0.02536065 -0.14360151 -0.13944003  0.04979166  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47768435877\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521565  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47768619892\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462916\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.477598402926\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.05631979 -0.52542671 -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.47761834187\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.5254267  -0.63203635 -0.02978569  0.07572119  0.34917709] 53734.477612779345\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203634 -0.02978569  0.07572119  0.34917709] 53734.4776159058\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978567  0.07572119  0.34917709] 53734.47760815556\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.0757212   0.34917709] 53734.477598371624\n","[-0.02536065 -0.14360151 -0.13944003  0.04979165  0.10521563  0.29462914\n"," -0.0563198  -0.52542671 -0.63203635 -0.02978569  0.07572119  0.3491771 ] 53734.47758910214\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03217860643\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03217860643\n","[-0.03424511 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.032138108916\n","[-0.03424512 -0.22852528 -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.0321164918\n","[-0.03424512 -0.2285253  -0.19649949  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03212945198\n","[-0.03424512 -0.2285253  -0.19649951  0.07371118  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03210044766\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665838  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.032091256166\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987349\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03216010243\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222128 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.03224130387\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544979 -0.70787489  0.25512402  0.45736286  0.61563578] 53775.032251341\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787487  0.25512402  0.45736286  0.61563578] 53775.03227630092\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512404  0.45736286  0.61563578] 53775.03231404009\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736288  0.61563578] 53775.03231635765\n","[-0.03424512 -0.2285253  -0.19649951  0.07371117  0.16665836  0.53987347\n","  0.09222126 -0.48544981 -0.70787489  0.25512402  0.45736286  0.61563579] 53775.03210170866\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.28465383493\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.28465383493\n","[-0.03001476 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.284646007174\n","[-0.03001478 -0.18808877 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.28464510447\n","[-0.03001478 -0.18808878 -0.16933059  0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.284648841065\n","[-0.03001478 -0.18808878 -0.1693306   0.06232189  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.28464185959\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740238  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.284638744866\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310025\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.284627627174\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149336 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.28466684859\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448482 -0.67176432  0.11946409  0.27564394  0.48876131] 52842.2846631517\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176431  0.11946409  0.27564394  0.48876131] 52842.28466998709\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.1194641   0.27564394  0.48876131] 52842.28468317151\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564396  0.48876131] 52842.284677537\n","[-0.03001478 -0.18808878 -0.1693306   0.06232187  0.13740237  0.42310023\n","  0.02149334 -0.50448484 -0.67176432  0.11946409  0.27564394  0.48876132] 52842.284594029574\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.70614630334\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.70614630334\n","[-0.02395538 -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.706144332944\n","[-0.0239554  -0.19590681 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.706149717196\n","[-0.0239554  -0.19590683 -0.17244503  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.70614750545\n","[-0.0239554  -0.19590683 -0.17244504  0.08041988  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.70614847574\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697427  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.706146680015\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703079\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.70611960137\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556104 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343874] 52404.706165008545\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.49008139 -0.69138388  0.15803028  0.34179492  0.61343874] 52404.706162559996\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138387  0.15803028  0.34179492  0.61343874] 52404.70617309965\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.1580303   0.34179492  0.61343874] 52404.706187973905\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179493  0.61343874] 52404.70618396689\n","[-0.0239554  -0.19590683 -0.17244504  0.08041987  0.16697425  0.50703077\n","  0.04556102 -0.4900814  -0.69138388  0.15803028  0.34179492  0.61343876] 52404.70608583945\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.004423630904\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.004423630904\n","[-0.01415605 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00443418958\n","[-0.01415606 -0.20821153 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00445462884\n","[-0.01415606 -0.20821154 -0.17588477  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00443774494\n","[-0.01415606 -0.20821154 -0.17588478  0.09924626  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00445541217\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156586  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00445631686\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894645\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.004396032964\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749308 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00444274603\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383318 -0.72167261  0.18099233  0.40366512  0.82761205] 51597.00444142069\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167259  0.18099233  0.40366512  0.82761205] 51597.00445358274\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099235  0.40366512  0.82761205] 51597.004467030936\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366514  0.82761205] 51597.00446484919\n","[-0.01415606 -0.20821154 -0.17588478  0.09924625  0.20156585  0.63894644\n","  0.06749306 -0.46383319 -0.72167261  0.18099233  0.40366512  0.82761206] 51597.00436699014\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.418976921566\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.418976921566\n","[ 0.00238031 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.418989061945\n","[ 0.00238029 -0.24204025 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.419014019724\n","[ 0.00238029 -0.24204026 -0.19287859  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.41899511138\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897944  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.41901603469\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908275  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.41901725158\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911254\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.418951892956\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258247 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.41899980906\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014225 -0.77916266  0.20728474  0.50011644  1.24242016] 50138.41900255658\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916265  0.20728474  0.50011644  1.24242016] 50138.41901444275\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728476  0.50011644  1.24242016] 50138.419029274664\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011646  1.24242016] 50138.41903195043\n","[ 0.00238029 -0.24204026 -0.19287861  0.11897942  0.24908273  0.88911253\n","  0.10258246 -0.41014227 -0.77916266  0.20728474  0.50011644  1.24242017] 50138.418926788654\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.734196039484\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.734196039484\n","[ 0.0377917  -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.73421813194\n","[ 0.03779168 -0.30196132 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.73426795175\n","[ 0.03779168 -0.30196134 -0.21933629  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.73420654531\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461677  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.734269051056\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399755  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.7342637815\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908904\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.73417651267\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432599 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.734215198056\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034626 -0.87945229  0.19958807  0.6083121   2.02918347] 47885.734237697834\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945227  0.19958807  0.6083121   2.02918347] 47885.73421086227\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958809  0.6083121   2.02918347] 47885.734233727\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.60831211  2.02918347] 47885.734249285364\n","[ 0.03779168 -0.30196134 -0.21933631  0.14461676  0.32399753  1.34908903\n","  0.14432598 -0.31034628 -0.87945229  0.19958807  0.6083121   2.02918348] 47885.73416570261\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39366190498\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39366190498\n","[ 0.08162895 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39316295553\n","[ 0.08162893 -0.39049521 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.3927755934\n","[ 0.08162893 -0.39049523 -0.21279043  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39291000448\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384931  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.393021260796\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975373  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.392233950246\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991264\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.393763480344\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956615 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39394206016\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174311 -0.93753748  0.14020256  0.63412553  2.86385162] 47959.39445512899\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753747  0.14020256  0.63412553  2.86385162] 47959.39373192521\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020257  0.63412553  2.86385162] 47959.39398943771\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412554  2.86385162] 47959.394430650114\n","[ 0.08162893 -0.39049523 -0.21279045  0.13384929  0.37975372  1.81991262\n","  0.15956613 -0.24174312 -0.93753748  0.14020256  0.63412553  2.86385163] 47959.393647224155\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48851782578\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48851782578\n","[ 0.06074093 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48854898162\n","[ 0.06074091 -0.34830969 -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48859274177\n","[ 0.06074091 -0.3483097  -0.21590947  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48854167479\n","[ 0.06074091 -0.3483097  -0.21590949  0.1389799   0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48854411128\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318646  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48862684895\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556983\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.488495994665\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230437 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.488529826165\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443183 -0.90986046  0.16849917  0.62182568  2.46614047] 46942.48855209659\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986044  0.16849917  0.62182568  2.46614047] 46942.488535115415\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849918  0.62182568  2.46614047] 46942.4885703498\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.6218257   2.46614047] 46942.48854784081\n","[ 0.06074091 -0.3483097  -0.21590949  0.13897988  0.35318645  1.59556982\n","  0.15230435 -0.27443185 -0.90986046  0.16849917  0.62182568  2.46614048] 46942.488492758304\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.588635966065\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.588635966065\n","[ 0.09357969 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.5880336033\n","[ 0.09357968 -0.42510853 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58755631797\n","[ 0.09357968 -0.42510855 -0.21722918  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58773810935\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456617  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58713881262\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996306  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58691476438\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519984\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58881020436\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913924 -0.21492783 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.5890122015\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492781 -0.96151083  0.11140132  0.6560466   3.16869168] 53573.58980214067\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151082  0.11140132  0.6560466   3.16869168] 53573.588553793525\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140134  0.6560466   3.16869168] 53573.589385859945\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.65604661  3.16869168] 53573.58961060418\n","[ 0.09357968 -0.42510855 -0.21722919  0.15456615  0.37996305  1.99519982\n","  0.16913923 -0.21492783 -0.96151083  0.11140132  0.6560466   3.1686917 ] 53573.58864014027\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.996230602126\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.996230602126\n","[ 0.06300222 -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.99617554502\n","[ 0.0630022  -0.35359808 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.996199330555\n","[ 0.0630022  -0.35359809 -0.21600035  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.996054812495\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005317  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.99620274502\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503031  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.9960899329\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308848\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.99624905469\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346362 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.99630132874\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033437 -0.91341712  0.16456739  0.62418214  2.51451836] 47536.99647720666\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.9134171   0.16456739  0.62418214  2.51451836] 47536.996173491236\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456741  0.62418214  2.51451836] 47536.996307055764\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418216  2.51451836] 47536.99642800032\n","[ 0.0630022  -0.35359809 -0.21600036  0.14005316  0.35503029  1.62308846\n","  0.15346361 -0.27033438 -0.91341712  0.16456739  0.62418214  2.51451838] 47536.99622299722\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64515395618\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64515395618\n","[ 0.06081941 -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.645068335565\n","[ 0.0608194  -0.34849323 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.6450739569\n","[ 0.0608194  -0.34849324 -0.21591263  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.644927219226\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901715  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64513168103\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325045  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.644920647304\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.5965249\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64517983484\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.1523446  -0.27428964 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64524041287\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428963 -0.9099839   0.16836271  0.62190747  2.46781948] 47438.64544281357\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.90998388  0.16836271  0.62190747  2.46781948] 47438.64509738909\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836273  0.62190747  2.46781948] 47438.64522723199\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190748  2.46781948] 47438.64539919822\n","[ 0.0608194  -0.34849324 -0.21591264  0.13901713  0.35325044  1.59652489\n","  0.15234458 -0.27428964 -0.9099839   0.16836271  0.62190747  2.4678195 ] 47438.645147491334\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.481574669146\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.481574669146\n","[ 0.06074105 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48160550975\n","[ 0.06074103 -0.34830997 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.481649070956\n","[ 0.06074103 -0.34830998 -0.21590948  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48159808325\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897996  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.481600866944\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318656  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48168276565\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557129\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48155292307\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230443 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48158683101\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443162 -0.90986065  0.16849896  0.62182581  2.46614303] 46942.48160941478\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986063  0.16849896  0.62182581  2.46614303] 46942.48159194287\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849898  0.62182581  2.46614303] 46942.48162722612\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182582  2.46614303] 46942.48160515437\n","[ 0.06074103 -0.34830998 -0.21590949  0.13897994  0.35318654  1.59557128\n","  0.15230441 -0.27443163 -0.90986065  0.16849896  0.62182581  2.46614305] 46942.48154961894\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90419050434\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90419050434\n","[ 0.06075024 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.904137589925\n","[ 0.06075023 -0.34833146 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90412950049\n","[ 0.06075023 -0.34833148 -0.21590985  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90409484598\n","[ 0.06075023 -0.34833148 -0.21590986  0.13898432  0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90419218624\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319405  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90405238546\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568314\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90419185919\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230914 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.90424614123\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441496 -0.9098751   0.16848298  0.62183538  2.46633967] 46943.904353780235\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.90987509  0.16848298  0.62183538  2.46633967] 46943.90420181408\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848299  0.62183538  2.46633967] 46943.9042525981\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.6218354   2.46633967] 46943.9043475777\n","[ 0.06075023 -0.34833148 -0.21590986  0.1389843   0.35319404  1.59568313\n","  0.15230912 -0.27441498 -0.9098751   0.16848298  0.62183538  2.46633968] 46943.90417038917\n","[ 0.06074151 -0.3483111  -0.21590951  0.13898017  0.35318693  1.5955771\n","  0.15230466 -0.27443077 -0.9098614   0.16849813  0.6218263   2.46615327] 46939.61821372493\n","[ 0.06074151 -0.3483111  -0.21590951  0.13898017  0.35318693  1.5955771\n","  0.15230466 -0.27443077 -0.9098614   0.16849813  0.6218263   2.46615327] 46939.61821372493\n","[ 0.06074153 -0.3483111  -0.21590951  0.13898017  0.35318693  1.5955771\n","  0.15230466 -0.27443077 -0.9098614   0.16849813  0.6218263   2.46615327] 46939.61820511904\n","[ 0.06074151 -0.34831109 -0.21590951  0.13898017  0.35318693  1.5955771\n","  0.15230466 -0.27443077 -0.9098614   0.16849813  0.6218263   2.46615327] 46939.61822402402\n"]}],"source":["from scipy.optimize import minimize\n","from scipy.optimize import show_options\n","ini_x0 = np.array(theta1)#np.array([2.39908588, -0.47031325, -0.07545652,  0.04410493,  0.05274356,\n","       #15.03518337,  1.36915445, -0.42847477, -0.16876704,  0.03462041,\n","       # 0.0711309 ,  6.1976059])#0*np.array(theta1_com)\n","print('start from:',ini_x0 )\n","\n","def func2(theta1,data_bz=data_bz,data_os=data_os,data_ai =data_ai,obserSo=obserSo,trans=trans):\n","  _,_,pi1,pi2 = ValueIterationCom(theta1,trans,obserSo)\n","\n","  p1 = pi1[data_os[0],data_bz,data_ai[0]]\n","  res = - np.sum(np.log(p1[np.where(p1!=0)]))\n","  for i in range(1,5):\n","    p2 = pi2[data_os[i],data_bz,data_ai[i]]\n","    res = res - np.sum(np.log(p2[np.where(p2!=0)]))\n","  print(theta1,res)\n","  return res/(5*data_sp*data_tm)\n","\n","start = time.time()\n","\n","res22 = minimize(func2,ini_x0)#,tol=1e-3)\n","print(time.time()-start)\n","print(res22,res22.fun*5*data_sp*data_tm) # 28min"]}],"metadata":{"colab":{"collapsed_sections":[],"name":"CompleteCase_MTypeQNew_Initial0","provenance":[],"authorship_tag":"ABX9TyNolOKQVNgAComKlJlQSr6b"},"kernelspec":{"display_name":"Python 3","name":"python3"},"language_info":{"name":"python"}},"nbformat":4,"nbformat_minor":0}